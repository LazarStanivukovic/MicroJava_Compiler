# MicroJava Compiler

A compiler for the MicroJava programming language, developed as a project for the **Programming Language Translators 1 (Programski prevodioci 1)** course at the Faculty of Electrical Engineering, University of Belgrade.

**Academic year:** 2025/2026  
**Exam period:** January-February

---

## Overview

This project implements a full compiler pipeline that translates syntactically and semantically correct MicroJava programs into MicroJava bytecode, executable on the MicroJava Virtual Machine (MJVM). The compiler consists of four core phases:

1. **Lexical Analysis** - Tokenizes MicroJava source code using JFlex
2. **Syntax Analysis** - Parses tokens into an AST using the AST-CUP parser generator
3. **Semantic Analysis** - Performs symbol table management and contextual condition checking
4. **Code Generation** - Produces executable `.obj` bytecode for the MJVM

## Project Structure

```
pp1lab.templateAST/
├── src/
│   ├── spec/
│   │   ├── mjlexer.flex              # JFlex lexer specification
│   │   ├── mjparser.cup              # AST-CUP parser specification
│   │   └── mjparser_astbuild.cup     # Generated CUP specification
│   └── rs/ac/bg/etf/pp1/
│       ├── Compiler.java             # Main entry point
│       ├── SemanticAnalyzer.java     # Semantic pass (visitor)
│       ├── CodeGenerator.java        # Code generation pass (visitor)
│       └── ast/                      # Auto-generated AST classes
├── test/                             # Test MicroJava programs (.mj)
└── libs/
    ├── cup_v10k.jar                  # AST-CUP generator
    ├── symboltable-1-1.jar           # Symbol table library
    └── mj-runtime-1.1.jar            # MJVM runtime (Code, disasm, Run)
```

## Features

### Level A - Core

- Global/local variable declarations (simple, array, enum types)
- Global constant declarations
- Assignment, increment (`++`), and decrement (`--`) statements
- `read()` and `print()` built-in functions
- Arithmetic expressions (`+`, `-`, `*`, `/`, `%`)
- Ternary conditional operator (`CondFact ? Expr : Expr`)
- Array access and `.length` field
- Enum support
- Function calls (with actual parameters)
- Error recovery for global variable definitions and assignment statements

### Level B - Control Flow & Functions

- All Level A features, plus:
- `if`/`else` conditional statements
- `for` loop with `break` and `continue`
- `switch`/`case` statements
- `return` statements
- Boolean conditions with `&&` and `||` operators
- Relational operators in conditions
- Global method definitions and calls
- Error recovery for formal parameters and `if` conditions

### Level C - OOP

- All Level B features, plus:
- Inner class definitions with fields and methods
- Class inheritance (`extends`)
- Abstract classes and abstract methods
- Object instantiation and arrays of objects
- Virtual function tables (polymorphic method dispatch)
- Substitution principle (derived class references where base class is expected)
- Error recovery for inner class field declarations and superclass extension

## Building & Running

### Prerequisites

- **JDK 1.8**
- Eclipse IDE (recommended, project template is pre-configured)

### Generate Lexer

```bash
java -jar libs/JFlex.jar src/spec/mjlexer.flex
```

### Generate Parser

```bash
java -jar libs/cup_v10k.jar src/spec/mjparser.cup
```

### Compile

```bash
javac -cp "libs/*:src" src/rs/ac/bg/etf/pp1/*.java
```

### Run Compiler

```bash
java -cp "libs/*:src" rs.ac.bg.etf.pp1.Compiler <input.mj> <output.obj>
```

- `<input.mj>` - Path to MicroJava source file
- `<output.obj>` - Path for the generated bytecode output

### Run on MJVM

```bash
java -cp libs/mj-runtime-1.1.jar rs.etf.pp1.mj.runtime.Run <output.obj>
```

### Disassemble

```bash
java -cp libs/mj-runtime-1.1.jar rs.etf.pp1.mj.runtime.disasm <output.obj>
```

## Testing

Test files are located in the `test/` directory with `.mj` extension. Each test has corresponding expected output files:

- `.out` - Expected standard output
- `.err` - Expected error output

To redirect outputs during testing:

```bash
java -cp "libs/*:src" rs.ac.bg.etf.pp1.Compiler test/input.mj test/output.obj >test/input.out 2>test/input.err
```

## Example MicroJava Program

```
program Program
abstract class A {
    int x[], y[];
    abstract int getValue(int a);
}

const int pi = 3, e = 2;
enum Broj { NULA, TRI = 3, PET = 5 }
int a, b;

class B extends A {
    int i;
    {
        int getValue(int a) int b; bool c; {
            return this.i + this.x[0] + a;
        }
        void m() int a; { }
    }
}

class C extends B { A theA; int a; }

{
    void main() A a; C c; int i; int x[]; char ch; {
        a = new A;
        a.x = new int[5];
        a.y = new int[5];
        c = new C;
        c.theA = a;
        c.x = new int[Broj.PET];
        x = new int[Broj.TRI];
        read(c.i);
        for (i = 0; i < x.length; i++) {
            read(c.x[i]);
            read(c.theA.x[i]);
        }
        read(ch);
        print(ch == 'e' ? e : pi);
        print(c.getValue(c.theA.x[0]));
        c.m();
    }
}
```

## References

- [MicroJava Language Specification](http://ir4pp1.etf.rs/Domaci/mikrojava_2025_2026_jan.pdf)
- [Project Template (Eclipse)](http://ir4pp1.etf.rs/Domaci/2017-2018/pp1lab.templateAST.zip)
- [Symbol Table Library](http://ir4pp1.etf.rs/Domaci/symboltable-1-1.jar)
- [MJVM Runtime](http://ir4pp1.etf.rs/Domaci/mj-runtime-1.1.jar)

## License

University project - Faculty of Electrical Engineering, University of Belgrade.
